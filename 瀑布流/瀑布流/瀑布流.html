<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>瀑布流</title>
    <link type="text/css" rel="stylesheet" href="style.css">
    <script src="http://libs.baidu.com/jquery/1.10.2/jquery.min.js"></script>
    <script>
    $( window ).on( 'load', function(){
        waterfall();
        var dataInt={"data":[{"src":"images/0.jpg"},{'src':'images/1.jpg'},{'src':'images/2.jpg'},{'src':'images/3.jpg'}]};
        $(window).on('scroll',function(){
            if(checkscrollside()){
                $.each( dataInt.data, function( index, value ){
                    var oBox=$('<div>').addClass('box').appendTo($('#main'));
                    var oPic=$('<div>').addClass('pic').appendTo($(oBox));
                    var oImg=$('<img>').attr('src',' '+$(value).attr('src')).appendTo($(oPic));
                });
                waterfall();
            }
        })
    });

    function waterfall(){
        var $boxs = $( '.box' );
        var w = $boxs.eq( 0 ).outerWidth();// 一个块框pin的宽
        var cols = Math.floor( $( window ).width() / w );//每行中能容纳的pin个数【窗口宽度除以一个块框宽度】
        //oParent.style.cssText='width:'+iPinW*num+'px;ma rgin:0 auto;';//设置父级居中样式：定宽+自动水平外边距
        $( '#main' ).width(w*cols).css('margin','0 auto');

        var hArr=[];//用于存储 每列中的所有块框相加的高度。

        $boxs.each( function( index, value ){
            var h = $boxs.eq( index ).outerHeight();
            if( index < cols ){
                hArr[ index ] = h; //第一行中的num个块框pin 先添加进数组pinHArr
            }else{
                var minH = Math.min.apply( null, hArr );//数组pinHArr中的最小值minH
                var minHIndex = $.inArray( minH, hArr );
                $( value ).css({
                    'position': 'absolute',
                    'top': minH + 'px',
                    'left': minHIndex*w+'px'
                });
                //数组 最小高元素的高 + 添加上的aPin[i]块框高
                hArr[ minHIndex ] += $boxs.eq( index ).outerHeight() + 15;//更新添加了块框后的列高
            }
        });
    }

    function checkscrollside(){
        var $lastbox = $( '.box').last();
        var lastboxdis = $lastbox.offset().top + Math.floor($lastbox.outerHeight()/2);//创建【触发添加块框函数waterfall()】的高度：最后一个块框的距离网页顶部+自身高的一半(实现未滚到底就开始加载)
        var scrollTop = $( window ).scrollTop();//注意解决兼容性
        var documentH = $( document ).width();//页面高度
        return (lastboxdis < scrollTop + documentH ) ? true : false;//到达指定高度后 返回true，触发waterfall()函数
    }
    </script>
</head>
<body>
<div id="main">
    <div class="box">
        <div class="pic">
            <img src="images/0.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/1.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/2.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/3.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/4.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/5.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/6.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/7.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/8.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/9.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/10.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/11.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/12.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/13.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/14.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/15.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/16.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/17.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/18.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/19.jpg">
        </div>
    </div>
    <div class="box">
        <div class="pic">
            <img src="images/20.jpg">
        </div>
    </div>




</div>
</body>
</html>
